Trying to make a kind of porting to cpp of the original c project

